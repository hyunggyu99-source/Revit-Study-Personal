<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HVAC Mechanical Analysis Dashboard</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <h1 class="logo" data-i18n="title">HVAC 기계설비 분석 대시보드</h1>
      <span class="badge">v5</span>
    </div>
    <div class="header-right">
      <div class="toggle-group toggle-lang">
        <button class="toggle-btn active" data-lang="ko" id="btnKO">한국어</button>
        <button class="toggle-btn" data-lang="en" id="btnEN">EN</button>
      </div>
      <div class="toggle-group toggle-unit">
        <button class="toggle-btn active" data-unit="ip" id="btnIP">IP</button>
        <button class="toggle-btn" data-unit="si" id="btnSI">SI</button>
      </div>
      <button id="btnTheme" class="btn btn-icon" title="Toggle theme"><span id="themeIcon">&#9790;</span></button>
    </div>
  </header>

  <!-- Upload Section -->
  <section class="upload-section" id="uploadSection">
    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">&#128196;</div>
      <h2 data-i18n="uploadTitle">HVAC / EnergyPlus HTML 보고서 업로드</h2>
      <p data-i18n="uploadDesc">여기에 HTML 파일을 드래그하거나 클릭하여 선택하세요</p>
      <p class="upload-hint" data-i18n="uploadHint">지원: K-HVAC Systems, Annual Building, Facility Component Load Summary</p>
      <input type="file" id="fileInput" accept=".html,.htm" multiple hidden>
    </div>
  </section>

  <!-- Report Cards -->
  <section class="report-cards" id="reportCards" style="display:none;">
    <div class="section-header">
      <h2><span data-i18n="reports">보고서</span> <span id="reportCount" class="count-badge">0</span></h2>
      <div>
        <button id="btnAddMore" class="btn btn-outline" data-i18n="addReport">+ 보고서 추가</button>
        <button id="btnClearAll" class="btn btn-ghost btn-danger" data-i18n="clearAll">전체 삭제</button>
      </div>
    </div>
    <div class="cards-grid" id="cardsGrid"></div>
  </section>

  <!-- Tab Navigation -->
  <nav class="tab-nav" id="tabNav" style="display:none;">
    <button class="tab active" data-tab="peakloads" data-i18n="tabPeakLoads">피크 부하</button>
    <button class="tab" data-tab="zones" data-i18n="tabZones">존</button>
    <button class="tab" data-tab="equipment" data-i18n="tabEquipment">장비/사이징</button>
    <button class="tab" data-tab="ventilation" data-i18n="tabVentilation">환기/외피</button>
    <button class="tab" data-tab="compare" data-i18n="tabCompare">보고서 비교</button>
    <button class="tab" data-tab="zonecompare" data-i18n="tabZoneCompare">존별 비교</button>
  </nav>

  <!-- ==================== Peak Loads Tab ==================== -->
  <section class="tab-content active" id="tab-peakloads" style="display:none;">
    <div class="tab-toolbar">
      <div class="report-selector">
        <label for="selPeakReport" data-i18n="reportLabel">보고서:</label>
        <select id="selPeakReport"></select>
      </div>
      <div class="report-selector">
        <label for="selPeakLevel" data-i18n="levelLabel">레벨:</label>
        <select id="selPeakLevel">
          <option value="facility">Facility</option>
        </select>
      </div>
      <div class="toggle-group">
        <button class="toggle-btn active" data-mode="cooling" id="btnCooling">
          <span class="toggle-icon">&#10052;</span> <span data-i18n="cooling">냉방</span>
        </button>
        <button class="toggle-btn" data-mode="heating" id="btnHeating">
          <span class="toggle-icon">&#9832;</span> <span data-i18n="heating">난방</span>
        </button>
      </div>
    </div>

    <div class="summary-cards" id="peakSummary"></div>

    <div class="charts-row">
      <div class="chart-card full-width">
        <h3 id="peakChartTitle" data-i18n="peakChartCooling">예상 냉방 피크 부하 구성요소</h3>
        <div class="chart-wrapper chart-wide"><canvas id="chartPeakLoad"></canvas></div>
      </div>
    </div>

    <div class="table-section">
      <h3 id="peakTableTitle" data-i18n="peakTableCooling">냉방 피크 부하 상세</h3>
      <div class="table-scroll"><table id="tablePeakLoad" class="data-table"></table></div>
    </div>

    <div class="highlight-legend">
      <h4 data-i18n="legendTitle">하이라이트 범례</h4>
      <div class="legend-items">
        <span class="legend-item"><span class="dot dot-high"></span> <span data-i18n="legendHigh">주요 구성요소 (전체의 >15%)</span></span>
        <span class="legend-item"><span class="dot dot-mid"></span> <span data-i18n="legendMid">유의미 (5~15%)</span></span>
        <span class="legend-item"><span class="dot dot-low"></span> <span data-i18n="legendLow">미미 (&lt;5%)</span></span>
        <span class="legend-item"><span class="dot dot-zero"></span> <span data-i18n="legendZero">0 / 비활성</span></span>
      </div>
    </div>

    <!-- Peak Load Explanation Panel -->
    <div class="explain-panel" id="peakExplainPanel">
      <div class="explain-toggle" id="peakExplainToggle">
        <span class="explain-icon">&#10067;</span> <span data-i18n="peakExplainToggle">피크 부하 수치 해설</span>
        <span class="explain-arrow" id="peakExplainArrow">&#9660;</span>
      </div>
      <div class="explain-body" id="peakExplainBody" style="display:none;">
        <div id="peakExplainContent"></div>
      </div>
    </div>
  </section>

  <!-- ==================== Zones Tab ==================== -->
  <section class="tab-content" id="tab-zones" style="display:none;">
    <div class="tab-toolbar">
      <div class="report-selector">
        <label for="selZoneReport" data-i18n="reportLabel">보고서:</label>
        <select id="selZoneReport"></select>
      </div>
    </div>
    <div class="charts-row">
      <div class="chart-card full-width">
        <h3 data-i18n="zoneChart">존 체적 및 벽면적 비교</h3>
        <div class="chart-wrapper chart-wide"><canvas id="chartZones"></canvas></div>
      </div>
    </div>
    <div class="table-section">
      <h3 data-i18n="zoneSummary">존 요약</h3>
      <div class="table-scroll"><table id="tableZoneSummary" class="data-table"></table></div>
    </div>
    <div class="table-section">
      <h3 data-i18n="spaceSummary">공간 요약</h3>
      <div class="table-scroll"><table id="tableSpaceSummary" class="data-table"></table></div>
    </div>
  </section>

  <!-- ==================== Equipment & Sizing Tab ==================== -->
  <section class="tab-content" id="tab-equipment" style="display:none;">
    <div class="tab-toolbar">
      <div class="report-selector">
        <label for="selEquipReport" data-i18n="reportLabel">보고서:</label>
        <select id="selEquipReport"></select>
      </div>
    </div>

    <div class="section-group-title"><span class="section-icon">&#9881;</span> <span data-i18n="eqGroupTitle">HVAC 장비</span></div>
    <div id="accordionEquipment"></div>

    <div class="section-group-title"><span class="section-icon">&#128208;</span> <span data-i18n="sizingTitle">HVAC 사이징 요약</span></div>
    <div id="accordionSizing"></div>
  </section>

  <!-- ==================== Ventilation & Envelope Tab ==================== -->
  <section class="tab-content" id="tab-ventilation" style="display:none;">
    <div class="tab-toolbar">
      <div class="report-selector">
        <label for="selVentReport" data-i18n="reportLabel">보고서:</label>
        <select id="selVentReport"></select>
      </div>
    </div>

    <div class="section-group-title"><span class="section-icon">&#127744;</span> <span data-i18n="ventTitle">환기 / 외기 도입</span></div>
    <div id="accordionVent"></div>

    <div class="section-group-title"><span class="section-icon">&#127970;</span> <span data-i18n="envTitle">건물 외피 (Envelope)</span></div>
    <div id="accordionEnv"></div>

    <div class="section-group-title"><span class="section-icon">&#9728;</span> <span data-i18n="sensHeatTitle">현열 획득 요약</span></div>
    <div id="accordionSensHeat"></div>
  </section>

  <!-- ==================== Report Compare Tab ==================== -->
  <section class="tab-content" id="tab-compare" style="display:none;">
    <div class="compare-header">
      <h2 data-i18n="compareTitle">보고서 비교</h2>
      <p class="compare-hint" id="compareHint" data-i18n="compareHint">비교를 위해 2개 이상의 보고서를 업로드하세요</p>
    </div>

    <div id="comparePeakSection" style="display:none;">
      <div class="toggle-group" style="margin-bottom:16px;">
        <button class="toggle-btn active" data-mode="cooling" id="btnCompareCooling">
          <span class="toggle-icon">&#10052;</span> <span data-i18n="cooling">냉방</span>
        </button>
        <button class="toggle-btn" data-mode="heating" id="btnCompareHeating">
          <span class="toggle-icon">&#9832;</span> <span data-i18n="heating">난방</span>
        </button>
      </div>
      <div class="charts-row">
        <div class="chart-card full-width">
          <h3 id="compareChartTitle" data-i18n="comparePeakCooling">피크 부하 비교 - 냉방</h3>
          <div class="chart-wrapper chart-wide"><canvas id="chartComparePeak"></canvas></div>
        </div>
      </div>
      <div class="table-section">
        <h3 data-i18n="sideBySide">나란히 비교</h3>
        <div class="table-scroll"><table id="tableComparePeak" class="data-table"></table></div>
      </div>
    </div>

    <!-- Monthly comparison removed: not relevant for K-HVAC design-day reports -->

    <div id="compareZoneChartSection" style="display:none;">
      <div class="charts-row">
        <div class="chart-card full-width">
          <h3 data-i18n="compareZone">존 총합 비교</h3>
          <div class="chart-wrapper chart-wide"><canvas id="chartCompareZones"></canvas></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ==================== Zone Compare Tab ==================== -->
  <section class="tab-content" id="tab-zonecompare" style="display:none;">
    <div class="compare-header">
      <h2 data-i18n="tabZoneCompare">존별 상세 비교</h2>
      <p class="compare-hint" id="zoneCompareHint" data-i18n="zoneCompareHint">2개 이상의 보고서를 업로드하면 존별로 수치 차이를 비교합니다</p>
    </div>
    <div id="zoneCompareContent" style="display:none;">
      <div class="tab-toolbar">
        <div class="zone-select-wrap" style="position:relative;">
          <label data-i18n="zoneSearchLabel">존 검색:</label>
          <input type="text" id="zoneSearchInput" class="zone-search-input" placeholder="" data-i18n-placeholder="zoneSearchPlaceholder" autocomplete="off" style="min-width:280px;">
          <div id="zoneAutoComplete" class="autocomplete-list" style="display:none;"></div>
        </div>
        <select id="selZoneFilter" style="padding:8px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--bg-card);color:var(--text);font-size:13px;min-width:160px;">
          <option value="__all__" data-i18n="allZones">전체 존</option>
        </select>
      </div>
      <div id="zoneCompareCards"></div>
    </div>
  </section>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Floating navigation -->
  <div id="floatingNav" class="floating-nav">
    <button id="btnTocToggle" class="toc-toggle-btn" title="목차">&#9776;</button>
    <div id="tocPanel" class="toc-panel" style="display:none;"></div>
    <button id="btnScrollTop" class="scroll-top-btn" title="맨 위로" style="display:none;">&#9650;</button>
  </div>

  <footer class="footer">
    <p data-i18n="footer">HVAC 기계설비 분석 대시보드 &mdash; 피크 부하 / 존 / 장비 / 환기 / 비교</p>
  </footer>

  <script src="js/parser.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
